#!/bin/bash

BIN="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
DIR="$BIN/../"
LIB="$DIR/lib"

vcf=$1
base=`basename $vcf .vcf`

vcf2tsv=$LIB/perl/vcf2tsv.pl
spliteff=$LIB/perl/splitEff.pl
filter=$LIB/perl/filter.pl
plotPng=$LIB/R/plotsPng.R

# TODO Fill in the blanks here:
canonicals=""
clinvar=""
cosmic=""
cosmicNC=""

# convert to tsv
echo `date` " [$$] - converting vcf to tsv" 
$vcf2tsv $base.vcf > $base.tsv

# split eff columns
echo `date` " [$$] - splitting vcf columns" 
$spliteff $base.tsv Falco >> $base.res.tsv

# Filter
echo `date` " [$$] - filtering data" 
#Rscript $filterR $base.res.tsv $base.qc.ann.txt 10 100 .95 $base
# Also clinvar and cosmic filtering!!!
$filter $base.res.tsv $canonicals $clinvar $cosmic $cosmicNC > $base.res.filtered.tsv
